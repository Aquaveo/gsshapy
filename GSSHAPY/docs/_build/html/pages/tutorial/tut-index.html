<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tutorial &mdash; GSSHAPY 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="GSSHAPY 1.0.0 documentation" href="../../index.html" />
    <link rel="next" title="Abstraction" href="tut-abstraction.html" />
    <link rel="prev" title="Introduction" href="../intro.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="tut-abstraction.html" title="Abstraction"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../intro.html" title="Introduction"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">GSSHAPY 1.0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>This is a simple tutorial meant to show GsshaPy users how to use the
GsshaPy ORM objects. The full tutorial script can be downloaded here:
<tt class="xref download docutils literal"><span class="pre">tutorial-script.py</span></tt></p>
<div class="section" id="overview">
<h2>Overview:<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="tut-abstraction.html">Abstraction</a></li>
</ul>
</div>
</div>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>Since GsshaPy is meant to read GSSHA model files into a database and write
them out again, a set of example GSSHA model files will be needed for the
tutorial. These can be downloaded here:
<tt class="xref download docutils literal"><span class="pre">tutorial-data.zip</span></tt>.</p>
<p>Unzip the contents of the file. This file will become the working directory
for the tutorial. The <tt class="docutils literal"><span class="pre">tutorial-data/write</span></tt> and <tt class="docutils literal"><span class="pre">tutorial-data/db</span></tt> directories
are purposely left empty.</p>
<p>The tutorial uses an SQLite database. Ensure that you have SQLite installed
on your system. Visit <a class="reference external" href="http://www.sqlite.org/">http://www.sqlite.org/</a> for download and installation
instructions. Windows users ensure that the sqlite executable is added to
your path.</p>
</div>
<div class="section" id="abstractio">
<h2>Abstractio<a class="headerlink" href="#abstractio" title="Permalink to this headline">¶</a></h2>
<p>The abstraction of GsshaPy is the GSSHA model file. There are many input and ouput
files that make up a GSSHA model. Each model file is represented in the GsshaPy ORM
by a <tt class="docutils literal"><span class="pre">GsshaPyFileObject</span></tt>. This object contains the <tt class="docutils literal"><span class="pre">read()</span></tt> and <tt class="docutils literal"><span class="pre">write()</span></tt>
methods that are used to read the file into an SQL database. There may also be one
or more <tt class="docutils literal"><span class="pre">TableObjects</span></tt> that are used to create tables for storing and organizing
the file data in the relational database fashion.</p>
<p>Both the <tt class="docutils literal"><span class="pre">TableObjects</span></tt> and the <tt class="docutils literal"><span class="pre">GsshaPyFileObjects</span></tt> inherit from the SQLAlchemy
declarative base class As a result, each object maps to a table in the database where
each record in the table is one object. For an explanation of the SQLAlchemy ORM see
<a class="reference external" href="http://docs.sqlalchemy.org/en/rel_0_8/orm/tutorial.html">http://docs.sqlalchemy.org/en/rel_0_8/orm/tutorial.html</a>. If you are not familiar with
SQLAlchemy, it strongly recommended that you follow this tutorial before you continue,
because GsshaPy relies on SQLAlchemy ORM concepts.</p>
<p>For this tutorial, we will play with the project file. The project file is the controlling
file for GSSHA models. It is denoted by the <tt class="docutils literal"><span class="pre">.prj</span></tt> file extension. The class associated
with the project file is called <strong>ProjectFile</strong>.</p>
</div>
<div class="section" id="initiate-gsshapy-database">
<h2>Initiate GsshaPy Database<a class="headerlink" href="#initiate-gsshapy-database" title="Permalink to this headline">¶</a></h2>
<p>The fisrt step is to create a database and populate it with all of the GsshaPy tables. For this
tutorial we will create an SQLite. This can be done by using the <tt class="docutils literal"><span class="pre">init_sqlite_db(path)</span></tt>
method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">gsshapy.lib</span> <span class="kn">import</span> <span class="n">db_tools</span> <span class="k">as</span> <span class="n">dbt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sqlalchemy_url</span> <span class="o">=</span> <span class="n">dbt</span><span class="o">.</span><span class="n">init_sqlite_db</span><span class="p">(</span><span class="s">&#39;/path/to/tutorial-data/db/gsshapy_parkcity.db&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This method creates the SQLite database and  populates it with the GsshaPy tables returing
the SQLAlchemy url for creating session objects. Next create an SQLAlchemy session object for
interacting with the database:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span> <span class="o">=</span> <span class="n">dbt</span><span class="o">.</span><span class="n">create_session</span><span class="p">(</span><span class="n">sqlalchemy_url</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="instantiate-projectfile">
<h2>Instantiate ProjectFile<a class="headerlink" href="#instantiate-projectfile" title="Permalink to this headline">¶</a></h2>
<p>Before we instantiate ProjectFile we need to define a few variables that will define
our workspace. GsshaPy needs to know the directory and file name of the file that will
be read into the database:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">readDirectory</span> <span class="o">=</span> <span class="s">&#39;/path/to/tutorial-data/directory&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;parkcity.prj&#39;</span>
</pre></div>
</div>
<p>Now we can create an instance of ProjectFile:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">gsshapy.orm</span> <span class="kn">import</span> <span class="n">ProjectFile</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">projectFile</span> <span class="o">=</span> <span class="n">ProjectFile</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">readDirectory</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="read-the-file-into-the-database">
<h2>Read the File into the Database<a class="headerlink" href="#read-the-file-into-the-database" title="Permalink to this headline">¶</a></h2>
<p>The newly created ProjectFile object has all the necessary information it needs to find
the file, parse it, and read it into the database. This is done by invoking the <tt class="docutils literal"><span class="pre">read()</span></tt>
method on <tt class="docutils literal"><span class="pre">projectFile</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">projectFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="explore-the-database">
<h2>Explore the Database<a class="headerlink" href="#explore-the-database" title="Permalink to this headline">¶</a></h2>
<p>To prove that the excercise has actually done something, it is userful to explore database.
Before we do this using the GsshaPy objects, lets explore a little using the <tt class="docutils literal"><span class="pre">sqlite</span></tt> commandline
utility. Open a terminal or command prompt and issue the following commands:</p>
<div class="highlight-python"><pre>$ cd /path/to/tutorial-data/db
$ sqlite3 gsshapy_parkcity.db
SQLite version 3.7.15.2
Enter ".help" for instructions
Enter SQL statements terminated with a ";"
sqlite&gt; .tables</pre>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">GSSHAPY was only tested with sqlite3. Use older versions at your own risk.</p>
</div>
<p>If the database was initialized correctly, you should see a list of about 50 or so tables. The three
letter prefix on the filename is associted with the file extension or in some cases the type of file.
Notice that there are two tables used to store project files: <tt class="docutils literal"><span class="pre">prj_project_files</span></tt> and <tt class="docutils literal"><span class="pre">prj_project_cards</span></tt>.
Most of the data is stored in the <tt class="docutils literal"><span class="pre">prj_project_cards</span></tt> table. Inspect the data by issuing the following
query:</p>
<div class="highlight-python"><pre>sqlite&gt; SELECT * FROM prj_project_cards;</pre>
</div>
<p>The project file stores all of the GSSHA model preferences using a card system. Each record in the
<tt class="docutils literal"><span class="pre">prj_project_cards</span></tt> table stores the <em>name</em> and <em>value</em> of one card in the project file.
The <tt class="docutils literal"><span class="pre">prj_project_cards</span></tt> table is related to the <tt class="docutils literal"><span class="pre">prj_project_files</span></tt> table through a foreign
key column called <em>projectFileID</em> (the column with all 1&#8217;s).</p>
</div>
<div class="section" id="querying-using-gsshapy-objects">
<h2>Querying Using GsshaPy Objects<a class="headerlink" href="#querying-using-gsshapy-objects" title="Permalink to this headline">¶</a></h2>
<p>There are two GsshaPy classes that are associated with the two project file tables discussed above.
The <strong>ProjectFile</strong> class maps to the <tt class="docutils literal"><span class="pre">prj_project_files</span></tt> table and the <strong>ProjectCard</strong> class
maps to the <tt class="docutils literal"><span class="pre">prj_project_cards</span></tt> class. Instances of these classes can be used to query the
database. This will be demonstrated through a set of scenarios presently.</p>
<p>Suppose we need to retrieve all of the project cards from a project file. We can use SQLAlchemy
session object and SQL expression language to do this. Back in the python console:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">gsshapy.orm</span> <span class="kn">import</span> <span class="n">ProjectCard</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cards</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">ProjectCard</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ProjectCard</span><span class="o">.</span><span class="n">projectFileID</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="n">cards</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">card</span>
<span class="gp">...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For an overview of the SQLAlchemy SQL expression language see the following tutorials:
<a class="reference external" href="http://docs.sqlalchemy.org/en/rel_0_8/orm/tutorial.html">Object Relational Tutorial</a> and <a class="reference external" href="http://docs.sqlalchemy.org/en/rel_0_8/core/tutorial.html">SQL Expression Language</a>.</p>
</div>
<p>The query returns a list of ProjectCard objects that represent the records in the <tt class="docutils literal"><span class="pre">prj_project_cards</span></tt>
table that have <em>projectFileID</em> equal to 1, where <em>projectFileID</em> is the foreign key field used
in the relationship between the <tt class="docutils literal"><span class="pre">prj_project_cards</span></tt> and <tt class="docutils literal"><span class="pre">prj_project_files</span></tt> tables. The <strong>ProjectCard</strong>
class also has a relationship property called <em>projectFile</em> that maps to the associate <strong>ProjectFile</strong>
class. Equivilently, we can filter the query using the <strong>ProjectFile</strong> instance we have already created:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">cards</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">ProjectCard</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ProjectCard</span><span class="o">.</span><span class="n">projectFile</span> <span class="o">==</span> <span class="n">projectFile</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="n">cards</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">card</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>Alternatively, the relationship properties can be used to issue the queries to the database.
The <strong>ProjectFile</strong> also has a relationship property, <em>projectCards</em>, that back references the <em>projectFile</em>
property of hte <strong>ProjectCard</strong> class. It can be used through the instance of our <strong>ProjectFile</strong> class
in this way:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">cards</span> <span class="o">=</span> <span class="n">projectFile</span><span class="o">.</span><span class="n">projectCards</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="n">cards</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">card</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>The attributes of each <strong>ProjectCard</strong> object can be retrieved using normal dot notation. The <strong>ProjectCard</strong>
has two value column attributes, <em>name</em> and <em>value</em>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="n">cards</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">card</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">card</span><span class="o">.</span><span class="n">value</span>
<span class="gp">...</span>
</pre></div>
</div>
</div>
<div class="section" id="write-from-database-to-file">
<h2>Write From Database to File<a class="headerlink" href="#write-from-database-to-file" title="Permalink to this headline">¶</a></h2>
<p>Reading GSSHA files is only half the story. GsshaPy is also able to read a GsshaPy database and export the
data back to the proper file format.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tutorial</a><ul>
<li><a class="reference internal" href="#overview">Overview:</a><ul>
</ul>
</li>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#abstractio">Abstractio</a></li>
<li><a class="reference internal" href="#initiate-gsshapy-database">Initiate GsshaPy Database</a></li>
<li><a class="reference internal" href="#instantiate-projectfile">Instantiate ProjectFile</a></li>
<li><a class="reference internal" href="#read-the-file-into-the-database">Read the File into the Database</a></li>
<li><a class="reference internal" href="#explore-the-database">Explore the Database</a></li>
<li><a class="reference internal" href="#querying-using-gsshapy-objects">Querying Using GsshaPy Objects</a></li>
<li><a class="reference internal" href="#write-from-database-to-file">Write From Database to File</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../intro.html"
                        title="previous chapter">Introduction</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="tut-abstraction.html"
                        title="next chapter">Abstraction</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/pages/tutorial/tut-index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="tut-abstraction.html" title="Abstraction"
             >next</a> |</li>
        <li class="right" >
          <a href="../intro.html" title="Introduction"
             >previous</a> |</li>
        <li><a href="../../index.html">GSSHAPY 1.0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Brigham Young University.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>